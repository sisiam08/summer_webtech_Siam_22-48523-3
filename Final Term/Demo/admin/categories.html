<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting to Categories</title>
    <script>
        // Redirect to the PHP version of the categories page
        window.location.href = 'categories.php';
    </script>
</head>
<body>
    <h1>Redirecting to Categories...</h1>
    <p>If you are not redirected automatically, <a href="categories.php">click here</a>.</p>
</body>
</html>tml>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Categories Management - Online Grocery Store</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="css/admin.css">
</head>
<body class="admin">
    <div class="admin-sidebar">
        <div class="brand">
            Grocery Admin
        </div>
        <div class="menu">
            <a href="index.html" class="menu-item">
                <i class="material-icons">dashboard</i> Dashboard
            </a>
            <a href="products.html" class="menu-item">
                <i class="material-icons">inventory</i> Products
            </a>
            <a href="categories.html" class="menu-item active">
                <i class="material-icons">category</i> Categories
            </a>
            <a href="orders.html" class="menu-item">
                <i class="material-icons">shopping_cart</i> Orders
            </a>
            <a href="users.html" class="menu-item">
                <i class="material-icons">people</i> Users
            </a>
            <a href="vendors.html" class="menu-item">
                <i class="material-icons">store</i> Vendors
            </a>
            <a href="settings.html" class="menu-item">
                <i class="material-icons">settings</i> Settings
            </a>
        </div>
    </div>

    <div class="admin-content">
        <div class="admin-header">
            <h2>Categories Management</h2>
            <div class="user-info">
                <div class="dropdown">
                    <span id="admin-username">Admin</span>
                    <i class="material-icons">arrow_drop_down</i>
                    <div class="dropdown-content">
                        <a href="profile.html">My Profile</a>
                        <a href="#" id="logout-btn">Logout</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="admin-body">
            <div class="action-bar">
                <button id="add-category-btn" class="btn primary"><i class="material-icons">add</i> Add New Category</button>
                
                <div class="search-filter">
                    <div class="search-box">
                        <input type="text" id="search-input" placeholder="Search categories...">
                        <button id="search-btn"><i class="material-icons">search</i></button>
                    </div>
                    
                    <div class="filter-box">
                        <select id="status-filter">
                            <option value="">All Status</option>
                            <option value="1">Active</option>
                            <option value="0">Inactive</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="data-table-container">
                <table class="data-table" id="categories-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Description</th>
                            <th>Status</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be populated by JavaScript -->
                    </tbody>
                </table>
                
                <div class="pagination">
                    <button id="prev-page" class="btn secondary"><i class="material-icons">navigate_before</i></button>
                    <span id="page-info">Page 1 of 1</span>
                    <button id="next-page" class="btn secondary"><i class="material-icons">navigate_next</i></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Form Modal -->
    <div id="category-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Add New Category</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="category-form">
                    <input type="hidden" id="category-id">
                    <div class="form-group">
                        <label for="category-name">Category Name:</label>
                        <input type="text" id="category-name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="category-description">Description:</label>
                        <textarea id="category-description" name="description" rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="category-status">Status:</label>
                        <select id="category-status" name="is_active">
                            <option value="1">Active</option>
                            <option value="0">Inactive</option>
                        </select>
                    </div>
                    <div class="form-buttons">
                        <button type="button" class="btn secondary" id="cancel-btn">Cancel</button>
                        <button type="submit" class="btn primary" id="save-btn">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirm Delete</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this category? This action cannot be undone.</p>
                <div class="form-buttons">
                    <button type="button" class="btn secondary" id="cancel-delete-btn">Cancel</button>
                    <button type="button" class="btn danger" id="confirm-delete-btn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check admin authentication on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check if admin is logged in
            fetch('../php/check_admin.php')
                .then(response => response.json())
                .then(data => {
                    if (!data.isAdmin) {
                        window.location.href = 'login.html';
                    } else {
                        document.getElementById('admin-username').textContent = data.name;
                        // Load categories after successful authentication
                        loadCategories();
                    }
                })
                .catch(error => {
                    console.error('Error checking admin status:', error);
                    window.location.href = 'login.html';
                });

            // Logout functionality
            document.getElementById('logout-btn').addEventListener('click', function(e) {
                e.preventDefault();
                fetch('../php/logout.php')
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            window.location.href = 'login.html';
                        }
                    })
                    .catch(error => console.error('Error logging out:', error));
            });

            // Add event listeners for category management
            setupEventListeners();
        });

        // Current page and search variables
        let currentPage = 1;
        let searchTerm = '';
        let statusFilter = '';
        let categoryToDelete = null;

        function setupEventListeners() {
            // Add Category button
            document.getElementById('add-category-btn').addEventListener('click', function() {
                document.getElementById('modal-title').textContent = 'Add New Category';
                document.getElementById('category-form').reset();
                document.getElementById('category-id').value = '';
                openModal('category-modal');
            });

            // Search button
            document.getElementById('search-btn').addEventListener('click', function() {
                searchTerm = document.getElementById('search-input').value;
                currentPage = 1;
                loadCategories();
            });

            // Enter key in search input
            document.getElementById('search-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchTerm = document.getElementById('search-input').value;
                    currentPage = 1;
                    loadCategories();
                }
            });

            // Status filter
            document.getElementById('status-filter').addEventListener('change', function() {
                statusFilter = this.value;
                currentPage = 1;
                loadCategories();
            });

            // Pagination buttons
            document.getElementById('prev-page').addEventListener('click', function() {
                if (currentPage > 1) {
                    currentPage--;
                    loadCategories();
                }
            });

            document.getElementById('next-page').addEventListener('click', function() {
                currentPage++;
                loadCategories();
            });

            // Category form submission
            document.getElementById('category-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveCategory();
            });

            // Cancel button in form
            document.getElementById('cancel-btn').addEventListener('click', function() {
                closeModal('category-modal');
            });

            // Close buttons for modals
            document.querySelectorAll('.close').forEach(function(closeBtn) {
                closeBtn.addEventListener('click', function() {
                    closeAllModals();
                });
            });

            // Confirm delete buttons
            document.getElementById('cancel-delete-btn').addEventListener('click', function() {
                closeModal('confirm-modal');
            });

            document.getElementById('confirm-delete-btn').addEventListener('click', function() {
                if (categoryToDelete) {
                    deleteCategory(categoryToDelete);
                }
            });
        }

        function loadCategories() {
            const url = `../php/admin/get_categories.php?page=${currentPage}&search=${searchTerm}&status=${statusFilter}`;
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error('Error loading categories:', data.error);
                        return;
                    }
                    
                    renderCategories(data.categories);
                    updatePagination(data.currentPage, data.totalPages);
                })
                .catch(error => console.error('Error loading categories:', error));
        }

        function renderCategories(categories) {
            const tableBody = document.querySelector('#categories-table tbody');
            tableBody.innerHTML = '';
            
            if (categories.length === 0) {
                const emptyRow = document.createElement('tr');
                emptyRow.innerHTML = '<td colspan="6" class="text-center">No categories found</td>';
                tableBody.appendChild(emptyRow);
                return;
            }
            
            categories.forEach(category => {
                const row = document.createElement('tr');
                const statusBadge = category.is_active == 1 
                    ? '<span class="badge success">Active</span>' 
                    : '<span class="badge danger">Inactive</span>';
                
                row.innerHTML = `
                    <td>${category.id}</td>
                    <td>${category.name}</td>
                    <td>${category.description || '-'}</td>
                    <td>${statusBadge}</td>
                    <td>${new Date(category.created_at).toLocaleDateString()}</td>
                    <td class="actions">
                        <button class="btn icon edit-btn" data-id="${category.id}"><i class="material-icons">edit</i></button>
                        <button class="btn icon delete-btn" data-id="${category.id}"><i class="material-icons">delete</i></button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Add event listeners for edit and delete buttons
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const categoryId = this.getAttribute('data-id');
                    editCategory(categoryId);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const categoryId = this.getAttribute('data-id');
                    confirmDelete(categoryId);
                });
            });
        }

        function updatePagination(currentPage, totalPages) {
            document.getElementById('page-info').textContent = `Page ${currentPage} of ${totalPages}`;
            document.getElementById('prev-page').disabled = currentPage <= 1;
            document.getElementById('next-page').disabled = currentPage >= totalPages;
        }

        function editCategory(categoryId) {
            fetch(`../php/admin/get_category.php?id=${categoryId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error('Error fetching category:', data.error);
                        return;
                    }
                    
                    // Populate form with category data
                    document.getElementById('modal-title').textContent = 'Edit Category';
                    document.getElementById('category-id').value = data.id;
                    document.getElementById('category-name').value = data.name;
                    document.getElementById('category-description').value = data.description || '';
                    document.getElementById('category-status').value = data.is_active;
                    
                    openModal('category-modal');
                })
                .catch(error => console.error('Error fetching category:', error));
        }

        function saveCategory() {
            const categoryId = document.getElementById('category-id').value;
            const endpoint = categoryId ? '../php/admin/update_category.php' : '../php/admin/add_category.php';
            
            const formData = {
                id: categoryId,
                name: document.getElementById('category-name').value,
                description: document.getElementById('category-description').value,
                is_active: document.getElementById('category-status').value
            };
            
            fetch(endpoint, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    closeModal('category-modal');
                    loadCategories();
                } else {
                    alert(data.message || 'Error saving category');
                }
            })
            .catch(error => console.error('Error saving category:', error));
        }

        function confirmDelete(categoryId) {
            categoryToDelete = categoryId;
            openModal('confirm-modal');
        }

        function deleteCategory(categoryId) {
            fetch('../php/admin/delete_category.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ id: categoryId })
            })
            .then(response => response.json())
            .then(data => {
                closeModal('confirm-modal');
                if (data.success) {
                    loadCategories();
                } else {
                    alert(data.message || 'Error deleting category');
                }
            })
            .catch(error => console.error('Error deleting category:', error));
        }

        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
        }
    </script>
</body>
</html>
